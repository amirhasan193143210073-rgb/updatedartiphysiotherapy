<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prescription Form</title>
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="css/Admin-style.css">
    <style>
      #content nav {
        background: linear-gradient(135deg, #89d909 0%, #adf071 50%, #deedd0 100%) !important;
        color: #000000 !important;
        border-bottom: 1px solid rgba(0,0,0,.08);
      }
      .arrowicon { color: #000000 !important; }

      #sidebar {
        background: linear-gradient(135deg, #89d909 0%, #adf071 50%, #deedd0 100%) !important;
        color: #000000 !important;
      }
      #sidebar .brand { background: transparent !important; color: #000000 !important; }
      #sidebar .brand .bx { color: #000000 !important; }
      #sidebar .side-menu li a { background: transparent !important; color: #000000 !important; }
      #sidebar .side-menu.top li a:hover { color: #89d909 !important; }
      #sidebar .side-menu.top li.active a { color: #89d909 !important; }
      #sidebar .side-menu li.active { background: rgba(0,0,0,.06) !important; }

      button.btn {
        padding: 10px 18px;
        background: linear-gradient(135deg, #89d909 0%, #adf071 50%, #deedd0 100%);
        color: #000000;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.95rem;
        box-shadow: 0 4px 12px rgba(137, 217, 9, 0.35);
        transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
      }

      button.btn:hover {
        background: linear-gradient(135deg, #89d909 0%, #89d909 100%);
        box-shadow: 0 6px 16px rgba(137, 217, 9, 0.45);
        transform: translateY(-1px);
      }
    </style>
</head>

<body>
    <!-- SIDEBAR -->
    <section id="sidebar">
        <a href="#" class="brand">
            <i class='bx bxs-smile'></i>
            <span class="text">Admin Panel</span>
        </a>
        <ul class="side-menu top">
            <li>
                <a href="Blog.html">
                    <i class='bx bxs-dashboard icon'></i>
                    <span class="text">Dashboard</span>
                </a>
            </li>
            <li>
                <a href="SubBlog.html">
                    <i class='bx bxs-image-add icon'></i>
                    <span class="text">Service gallery</span>
                </a>
            </li>
            <li>
                <a href="select_section_view.html">
                    <i class='bx bxs-slideshow icon'></i>
                    <span class="text">section view</span>
                </a>
            </li>
            <li class="active">
                <a href="prescription_form.html">
                    <i class='bx bxs-cog icon'></i>
                    <span class="text">Create Prescription</span>
                </a>
            </li>
            <li>
                <a href="invoice.html">
                    <i class='bx bxs-receipt icon'></i>
                    <span class="text">Create Invoice</span>
                </a>
            </li>
            <li>
                <a href="Client-History.html">
                    <i class='bx bxs-book-open icon'></i>
                    <span class="text">Patient Record</span>
                </a>
            </li>
              <li>
        <a href="video-consultation.html">
          <i class='bx bxs-video icon'></i>
          <span class="text">Video Consultation</span>
        </a>
      </li>
      <li>
        <a href="send-video-whatsapp.html">
          <i class='bx bxs-share icon'></i>
          <span class="text">Shre Video</span>
        </a>
      </li>
        </ul>
    </section>
    <!-- SIDEBAR -->
    <section id="content">
        <nav>
            <!-- <i class='bx bx-menu' ></i> -->
            <i class='bx bx-left-arrow-alt arrowicon'></i>
            <i class='bx bx-right-arrow-alt arrowicon' style="display: none;"></i>
        </nav>
    </section>

    <form enctype="multipart/form-data" id="upload_submit">
        <div class="container" style="background:#fff; border:1px solid #eef1f6; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.06);">
            <div class="section">
                <h2 style="color:#111827; margin-top:0;">Prescription Form</h2>
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required>
                <label for="name">Phone:</label>
                <input type="text" id="phoneNumber" name="phoneNumber" required>
                <label for="age">Age:</label>
                <input type="number" name="age" id="age" required>
                <h3>Gender:</h3>
                <div class="gender-option">
                    <div class="gender">
                        <input type="radio" id="check-male" name="gender" />
                        <label for="check-male">male</label>
                    </div>
                    <div class="gender">
                        <input type="radio" id="check-female" name="gender" />
                        <label for="check-female">Female</label>
                    </div>
                    <div class="gender">
                        <input type="radio" id="check-other" name="gender" />
                        <label for="check-other">Others</label>
                    </div>
                </div>
                <label for="problem">Patient Problem:</label>
                <textarea id="problem" name="problem" rows="2" required></textarea>
                <label for="dr_note">Doctor Note:</label>
                <textarea id="dr_note" name="dr_note" rows="4" required></textarea>
                <button class="btn" id="upload-submit">Submit</button>
            </div>
        </div>
    </form>

    <script>
    const API_BASE = 'https://d17q6ufckg.execute-api.ap-south-1.amazonaws.com';
    const API = API_BASE.replace(/\/dev\/?$/, '');

    document.getElementById("upload-submit").addEventListener("click", async function (event) {
      event.preventDefault();

      var name = document.getElementById("name").value.trim();
      var phoneNumber = document.getElementById("phoneNumber").value.trim();
      var Age = document.getElementById("age").value;
      var Patient_Problem = document.getElementById("problem").value.trim();
      var Doctor_Note = document.getElementById("dr_note").value.trim();
      const selectedGender = document.querySelector('input[name="gender"]:checked');

      if (!selectedGender) {
        alert("No gender selected!");
        return;
      }

      if (!name) {
        alert("Please enter patient name.");
        return;
      }

      const genderLabel = document.querySelector(`label[for="${selectedGender.id}"]`).innerText;
      const genderNormalized = genderLabel.trim().toLowerCase();
      let genderValue = 'Other';
      if (genderNormalized === 'male') genderValue = 'Male';
      else if (genderNormalized === 'female') genderValue = 'Female';

      try {
        if (!API_BASE || API_BASE.includes('YOUR_API_BASE_URL')) {
          alert('Prescription API base URL is not configured.');
          return;
        }

        const res = await fetch(`${API}/prescription`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            patientName: name,
            phoneNumber: phoneNumber,
            age: Age,
            gender: genderValue,
            patientProblem: Patient_Problem,
            doctorNote: Doctor_Note,
            date: new Date().toISOString().slice(0, 10)
          })
        });

        if (!res.ok) {
          const text = await res.text();
          throw new Error(text || 'Failed to save prescription');
        }

        alert('Prescription saved successfully! Redirecting to Client History.');
        window.location.href = 'Client-History.html';
      } catch (err) {
        console.error('Error saving prescription:', err);
        alert('Failed to save prescription. Please try again.');
      }
    });
  </script>
    <script src="js/admin-script.js"></script>

</body>

</html>